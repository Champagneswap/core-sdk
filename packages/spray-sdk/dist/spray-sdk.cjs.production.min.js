"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e,n,r=require("@champagneswap/core-sdk"),i=t(require("jsbi")),o=t(require("@sushiswap/trident/exports/all.json")),u=t(require("@sushiswap/trident/artifacts/contracts/pool/ConstantProductPool.sol/ConstantProductPool.json")),s=require("@ethersproject/solidity"),a=require("@ethersproject/abi"),c=require("@ethersproject/address"),d=t(require("tiny-invariant")),l=require("@champagneswap/castle"),h=require("@ethersproject/bignumber"),y=t(require("@sushiswap/trident/artifacts/contracts/pool/HybridPool.sol/HybridPool.json")),m=r.JSBI.BigInt(100),f=r.JSBI.BigInt(1e4),p=((e={})[r.ChainId.KOVAN]="0x473Ef9B3e01E34b242b13F875b123E53208C88FA",e[r.ChainId.RINKEBY]="0x473Ef9B3e01E34b242b13F875b123E53208C88FA",e);function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function q(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function k(){return(k=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}(n=exports.Fee||(exports.Fee={}))[n.LOW=1]="LOW",n[n.MEDIUM=5]="MEDIUM",n[n.DEFAULT=30]="DEFAULT",n[n.HIGH=100]="HIGH";var A=function(t){return s.keccak256(["bytes"],[s.pack(["bytes","bytes"],[t.creationCode,a.defaultAbiCoder.encode(["bytes","address"],[t.deployData,t.masterDeployerAddress])])])},I=function(t){var e=t.factoryAddress,n=t.tokenA,i=t.tokenB,d=t.fee,l=t.twap,h=n.sortsBefore(i)?[n,i]:[i,n],y=a.defaultAbiCoder.encode(["address","address","uint256","bool"],[].concat([h[0].address,h[1].address].sort(),[d,l])),m=A({creationCode:u.bytecode,deployData:y,masterDeployerAddress:o[r.ChainId.KOVAN][r.ChainKey.KOVAN].contracts.MasterDeployer.address});return c.getCreate2Address(e,s.keccak256(["bytes"],[y]),m)},g=function(){function t(e,n,i,o){void 0===i&&(i=exports.Fee.DEFAULT),void 0===o&&(o=!0);var u=e.currency.sortsBefore(n.currency)?[e,n]:[n,e];this.liquidityToken=new r.Token(u[0].currency.chainId,t.getAddress(u[0].currency,u[1].currency,i,o),18,"SLP","Sushi LP Token"),this.fee=i,this.twap=o,this.tokenAmounts=u}t.getAddress=function(t,e,n,i){return void 0===n&&(n=exports.Fee.DEFAULT),void 0===i&&(i=!0),I({factoryAddress:o[r.ChainId.KOVAN][r.ChainKey.KOVAN].contracts.ConstantProductPoolFactory.address,tokenA:t,tokenB:e,fee:n,twap:i})};var e=t.prototype;return e.involvesToken=function(t){return t.equals(this.token0)||t.equals(this.token1)},e.priceOf=function(t){return this.involvesToken(t)||d(!1),t.equals(this.token0)?this.token0Price:this.token1Price},e.reserveOf=function(t){return this.involvesToken(t)||d(!1),t.equals(this.token0)?this.reserve0:this.reserve1},e.getOutputAmount=function(e){if(this.involvesToken(e.currency)||d(!1),i.equal(this.reserve0.quotient,r.ZERO)||i.equal(this.reserve1.quotient,r.ZERO))throw new r.InsufficientReservesError;var n=this.reserveOf(e.currency),o=this.reserveOf(e.currency.equals(this.token0)?this.token1:this.token0),u=i.multiply(e.quotient,i.subtract(f,i.BigInt(this.fee))),s=i.multiply(u,o.quotient),a=i.add(i.multiply(n.quotient,f),u),c=r.CurrencyAmount.fromRawAmount(e.currency.equals(this.token0)?this.token1:this.token0,i.divide(s,a));if(i.equal(c.quotient,r.ZERO))throw new r.InsufficientInputAmountError;return[c,new t(n.add(e),o.subtract(c),this.fee,this.twap)]},e.getInputAmount=function(e){if(this.involvesToken(e.currency)||d(!1),i.equal(this.reserve0.quotient,r.ZERO)||i.equal(this.reserve1.quotient,r.ZERO)||i.greaterThanOrEqual(e.quotient,this.reserveOf(e.currency).quotient))throw new r.InsufficientReservesError;var n=this.reserveOf(e.currency),o=this.reserveOf(e.currency.equals(this.token0)?this.token1:this.token0),u=i.multiply(i.multiply(o.quotient,e.quotient),f),s=i.multiply(i.subtract(n.quotient,e.quotient),i.subtract(f,i.BigInt(this.fee))),a=r.CurrencyAmount.fromRawAmount(e.currency.equals(this.token0)?this.token1:this.token0,i.add(i.divide(u,s),r.ONE));return[a,new t(o.add(a),n.subtract(e),this.fee,this.twap)]},e.getNonOptimalMintFee=function(t,e,n,o){if(i.equal(n,r.ZERO)||i.equal(o,r.ZERO))return[r.ZERO,r.ZERO];var u=i.divide(i.multiply(t,o),n);if(i.lessThanOrEqual(u,e))return[r.ZERO,i.divide(i.multiply(i.BigInt(this.fee),i.subtract(e,u)),i.multiply(i.BigInt(2),i.BigInt(1e4)))];var s=i.divide(i.multiply(e,n),o);return[i.divide(i.multiply(i.BigInt(this.fee),i.subtract(t,s)),i.multiply(i.BigInt(2),i.BigInt(1e4))),r.ZERO]},e.getMintFee=function(t,e,n){if(console.log("getMintFee",{kLast:this.kLast.toString(),computed:r.sqrt(i.multiply(t,e)).toString(),totalSupply:n.toString()}),i.notEqual(this.kLast,r.ZERO)){var o=r.sqrt(i.multiply(t,e));if(i.greaterThan(o,this.kLast)){var u=i.divide(i.divide(i.multiply(i.multiply(n,i.subtract(o,this.kLast)),i.BigInt(5)),o),i.BigInt(1e4));if(console.log({kLast:this.kLast.toString(),computed:o.toString(),liquidity:u.toString()}),i.notEqual(u,r.ZERO))return u}}return r.ZERO},e.getLiquidityMinted=function(t,e,n){t.currency.equals(this.liquidityToken)||d(!1);var o,u=e.currency.sortsBefore(n.currency)?[e,n]:[n,e];u[0].currency.equals(this.token0)&&u[1].currency.equals(this.token1)||d(!1);var s=i.add(u[0].quotient,this.reserve0.quotient),a=i.add(u[1].quotient,this.reserve1.quotient),c=r.sqrt(i.multiply(s,a));if(i.equal(t.quotient,r.ZERO))o=i.subtract(c,r.MINIMUM_LIQUIDITY);else{var l=this.getNonOptimalMintFee(u[0].quotient,u[1].quotient,this.reserve0.quotient,this.reserve1.quotient),h=l[1],y=i.add(this.reserve0.quotient,l[0]),m=i.add(this.reserve1.quotient,h),f=r.sqrt(i.multiply(y,m)),p=this.getMintFee(y,m,t.quotient);o=i.divide(i.multiply(i.subtract(c,f),i.add(t.quotient,p)),f)}if(!i.greaterThan(o,r.ZERO))throw new r.InsufficientInputAmountError;return r.CurrencyAmount.fromRawAmount(this.liquidityToken,o)},e.getLiquidityValue=function(t,e,n){return this.involvesToken(t)||d(!1),e.currency.equals(this.liquidityToken)||d(!1),n.currency.equals(this.liquidityToken)||d(!1),i.lessThanOrEqual(n.quotient,e.quotient)||d(!1),r.CurrencyAmount.fromRawAmount(t,i.divide(i.multiply(n.quotient,this.reserveOf(t).quotient),e.quotient))},e.getAmountOut=function(t,e,n){var r=i.multiply(t,i.subtract(f,i.BigInt(this.fee)));return i.divide(i.multiply(r,n),i.add(i.multiply(e,f),r))},e.getLiquidityValueSingleToken=function(t,e,n){this.involvesToken(t)||d(!1),e.currency.equals(this.liquidityToken)||d(!1),n.currency.equals(this.liquidityToken)||d(!1),i.lessThanOrEqual(n.quotient,e.quotient)||d(!1);var o=i.add(e.quotient,this.getMintFee(this.reserve0.quotient,this.reserve1.quotient,e.quotient)),u=i.divide(i.multiply(n.quotient,this.reserve0.quotient),o),s=i.divide(i.multiply(n.quotient,this.reserve1.quotient),o);return r.CurrencyAmount.fromRawAmount(t,t===this.token1?i.add(s,this.getAmountOut(u,i.subtract(this.reserve0.quotient,u),i.subtract(this.reserve1.quotient,s))):i.add(u,this.getAmountOut(s,i.subtract(this.reserve1.quotient,s),i.subtract(this.reserve0.quotient,u))))},q(t,[{key:"token0Price",get:function(){var t=this.tokenAmounts[1].divide(this.tokenAmounts[0]);return new r.Price(this.token0,this.token1,t.denominator,t.numerator)}},{key:"token1Price",get:function(){var t=this.tokenAmounts[0].divide(this.tokenAmounts[1]);return new r.Price(this.token1,this.token0,t.denominator,t.numerator)}},{key:"chainId",get:function(){return this.token0.chainId}},{key:"token0",get:function(){return this.tokenAmounts[0].currency}},{key:"token1",get:function(){return this.tokenAmounts[1].currency}},{key:"reserve0",get:function(){return this.tokenAmounts[0]}},{key:"reserve1",get:function(){return this.tokenAmounts[1]}},{key:"assets",get:function(){return[this.tokenAmounts[0].currency,this.tokenAmounts[1].currency]}},{key:"reserves",get:function(){return[this.reserve0,this.reserve1]}},{key:"kLast",get:function(){return r.sqrt(this.reserve0.multiply(this.reserve1).quotient)}}]),t}();function T(t){if(t instanceof g)return new l.ConstantProductRPool(t.liquidityToken.address,t.assets[0].wrapped,t.assets[1].wrapped,t.fee/1e4,h.BigNumber.from(t.reserves[0].quotient.toString()),h.BigNumber.from(t.reserves[1].quotient.toString()));if(t instanceof r.Pair)return new l.ConstantProductRPool(t.liquidityToken.address,t.token0,t.token1,exports.Fee.DEFAULT/1e4,h.BigNumber.from(t.reserve0.quotient.toString()),h.BigNumber.from(t.reserve1.quotient.toString()));throw new Error("Unsupported type of pool !!!")}function E(t,e,n){if(r.JSBI.equal(t,r.ZERO)&&r.JSBI.equal(e,r.ZERO))return r.ZERO;for(var i,o=r.JSBI.add(t,e),u=r.JSBI.multiply(n,r.JSBI.BigInt(2)),s=o,a=0;a<256;a++){var c=r.JSBI.divide(r.JSBI.divide(r.JSBI.multiply(r.JSBI.divide(r.JSBI.multiply(s,s),t),s),e),r.JSBI.BigInt(4));if(i=s,s=r.JSBI.divide(r.JSBI.multiply(r.JSBI.add(r.JSBI.divide(r.JSBI.multiply(u,o),m),r.JSBI.multiply(c,r.JSBI.BigInt(2))),s),r.JSBI.add(r.JSBI.multiply(r.JSBI.subtract(r.JSBI.divide(u,m),r.JSBI.BigInt(1)),s),r.JSBI.multiply(c,r.JSBI.BigInt(3)))),r.JSBI.lessThanOrEqual(r.difference(s,i),r.ONE))break}return s}var O,B,b=function(t){var e=t.factoryAddress,n=t.tokenA,i=t.tokenB,u=t.fee,d=t.a,l=n.sortsBefore(i)?[n,i]:[i,n],h=a.defaultAbiCoder.encode(["address","address","uint256","uint256"],[].concat([l[0].address,l[1].address].sort(),[u,d])),m=A({creationCode:y.bytecode,deployData:h,masterDeployerAddress:o[r.ChainId.KOVAN][r.ChainKey.KOVAN].contracts.MasterDeployer.address});return c.getCreate2Address(e,s.keccak256(["bytes"],[h]),m)};(O=exports.PoolState||(exports.PoolState={}))[O.LOADING=0]="LOADING",O[O.NOT_EXISTS=1]="NOT_EXISTS",O[O.EXISTS=2]="EXISTS",O[O.INVALID=3]="INVALID",(B=exports.RouteType||(exports.RouteType={})).SinglePool="SinglePool",B.SinglePath="SinglePath",B.ComplexPath="ComplexPath",B.Unknown="Unknown";var S=function(){function t(e,n,i,o){void 0===i&&(i=exports.Fee.DEFAULT),void 0===o&&(o=m);var u=e.currency.sortsBefore(n.currency)?[e,n]:[n,e];this.liquidityToken=new r.Token(u[0].currency.chainId,t.getAddress(u[0].currency,u[1].currency,i,o),18,"SLP","Sushi LP Token"),this.fee=i,this.a=o,this.tokenAmounts=u}t.getAddress=function(t,e,n,i){return void 0===n&&(n=exports.Fee.DEFAULT),void 0===i&&(i=m),b({factoryAddress:o[r.ChainId.KOVAN][r.ChainKey.KOVAN].contracts.HybridPoolFactory.address,tokenA:t,tokenB:e,fee:n,a:i})};var e=t.prototype;return e.involvesToken=function(t){return t.equals(this.token0)||t.equals(this.token1)},e.priceOf=function(t){return this.involvesToken(t)||d(!1),t.equals(this.token0)?this.token0Price:this.token1Price},e.reserveOf=function(t){return this.involvesToken(t)||d(!1),t.equals(this.token0)?this.reserve0:this.reserve1},e.getNonOptimalMintFee=function(t,e,n,o){if(i.equal(n,r.ZERO)||i.equal(o,r.ZERO))return[r.ZERO,r.ZERO];var u=i.divide(i.multiply(t,o),n);if(i.lessThanOrEqual(u,e))return[r.ZERO,i.divide(i.multiply(i.BigInt(this.fee),i.subtract(e,u)),i.multiply(i.BigInt(2),i.BigInt(1e4)))];var s=i.divide(i.multiply(e,n),o);return[i.divide(i.multiply(i.BigInt(this.fee),i.subtract(t,s)),i.multiply(i.BigInt(2),i.BigInt(1e4))),r.ZERO]},e.getLiquidityMinted=function(t,e,n){t.currency.equals(this.liquidityToken)||d(!1);var o=e.currency.sortsBefore(n.currency)?[e,n]:[n,e];o[0].currency.equals(this.token0)&&o[1].currency.equals(this.token1)||d(!1);var u,s=i.add(o[0].quotient,this.reserve0.quotient),a=i.add(o[1].quotient,this.reserve1.quotient),c=this.getNonOptimalMintFee(o[0].quotient,o[1].quotient,this.reserve0.quotient,this.reserve1.quotient),l=c[1],h=E(i.subtract(s,c[0]),i.subtract(a,l),this.a);if(i.equal(t.quotient,r.ZERO))u=i.subtract(h,i.BigInt(1e3));else{var y=E(this.reserve0.quotient,this.reserve1.quotient,this.a);u=i.divide(i.multiply(i.subtract(h,y),t.quotient),y)}if(!i.greaterThan(u,r.ZERO))throw new r.InsufficientInputAmountError;return r.CurrencyAmount.fromRawAmount(this.liquidityToken,u)},e.getLiquidityValue=function(t,e,n){return this.involvesToken(t)||d(!1),e.currency.equals(this.liquidityToken)||d(!1),n.currency.equals(this.liquidityToken)||d(!1),i.lessThanOrEqual(n.quotient,e.quotient)||d(!1),r.CurrencyAmount.fromRawAmount(t,i.divide(i.multiply(n.quotient,this.reserveOf(t).quotient),e.quotient))},q(t,[{key:"token0Price",get:function(){var t=this.tokenAmounts[1].divide(this.tokenAmounts[0]);return new r.Price(this.token0,this.token1,t.denominator,t.numerator)}},{key:"token1Price",get:function(){var t=this.tokenAmounts[0].divide(this.tokenAmounts[1]);return new r.Price(this.token1,this.token0,t.denominator,t.numerator)}},{key:"chainId",get:function(){return this.token0.chainId}},{key:"token0",get:function(){return this.tokenAmounts[0].currency}},{key:"token1",get:function(){return this.tokenAmounts[1].currency}},{key:"assets",get:function(){return[this.tokenAmounts[0].currency,this.tokenAmounts[1].currency]}},{key:"reserves",get:function(){return[this.reserve0,this.reserve1]}},{key:"reserve0",get:function(){return this.tokenAmounts[0]}},{key:"reserve1",get:function(){return this.tokenAmounts[1]}}]),t}(),P=function(){function t(t,e){this.route=t,this.tradeType=e;var n=r.CurrencyAmount.fromRawAmount(t.fromToken,t.amountIn.toFixed(0)),i=r.CurrencyAmount.fromRawAmount(t.toToken,t.amountOut.toFixed(0));e===r.TradeType.EXACT_INPUT?(this.inputAmount=r.CurrencyAmount.fromFractionalAmount(n.currency,n.numerator,n.denominator),this.outputAmount=r.CurrencyAmount.fromFractionalAmount(i.currency,i.numerator,i.denominator)):(this.inputAmount=r.CurrencyAmount.fromFractionalAmount(n.currency,i.numerator,i.denominator),this.outputAmount=r.CurrencyAmount.fromFractionalAmount(i.currency,n.numerator,n.denominator)),this.executionPrice=new r.Price(this.inputAmount.currency,this.outputAmount.currency,this.inputAmount.quotient,this.outputAmount.quotient),this.priceImpact=new r.Percent(r.JSBI.BigInt(0),r.JSBI.BigInt(1e4))}t.exactIn=function(e){return new t(e,r.TradeType.EXACT_INPUT)},t.exactOut=function(e){return new t(e,r.TradeType.EXACT_OUTPUT)};var e=t.prototype;return e.minimumAmountOut=function(t){if(t.lessThan(r.ZERO)&&d(!1),this.tradeType===r.TradeType.EXACT_OUTPUT)return this.outputAmount;var e=new r.Fraction(r.ONE).add(t).invert().multiply(this.outputAmount.quotient).quotient;return r.CurrencyAmount.fromRawAmount(this.outputAmount.currency,e)},e.maximumAmountIn=function(t){if(t.lessThan(r.ZERO)&&d(!1),this.tradeType===r.TradeType.EXACT_INPUT)return this.inputAmount;var e=new r.Fraction(r.ONE).add(t).multiply(this.inputAmount.quotient).quotient;return r.CurrencyAmount.fromRawAmount(this.inputAmount.currency,e)},t.bestTradeExactIn=function(e,n,i){return new t(k({},e,{fromToken:n.currency,toToken:i}),r.TradeType.EXACT_INPUT)},t.bestTradeExactOut=function(e,n,i){return new t(k({},e,{fromToken:n,toToken:i.currency}),r.TradeType.EXACT_OUTPUT)},t}();exports.A_PRECISION=m,exports.ConstantProductPool=g,exports.HybridPool=S,exports.MAX_FEE=f,exports.Pool=function(){},exports.ROUTER_ADDRESS=p,exports.Trade=P,exports.calcTokenPrices=function(t,e){var n=l.calcTokenPrices(t.map(T),e),i={};return Array.from(n.entries()).forEach((function(t){var n=t[0];return i[n.address]=new r.Price(n,e,1e18,Math.round(1e18*t[1]))})),i},exports.computeConstantProductPoolAddress=I,exports.computeHybridLiquidity=E,exports.computeHybridPoolAddress=b,exports.computePoolInitCodeHash=A,exports.convertPoolOrPairtoRPool=T,exports.convertTinesSingleRouteToLegacyRoute=function(t,e,n,i){var o=new Map;e.forEach((function(t){return o.set(t.liquidityToken.address,t)}));var u=t.legs.map((function(t){var e=o.get(t.poolAddress);if(void 0===e)throw new Error("Internal Error 119");return e}));return new r.Route(u,n,i)},exports.findMultiRouteExactIn=function(t,e,n,r,i,o){return l.findMultiRouteExactIn(t,e,n,r.map(T),i,o)},exports.findMultiRouteExactOut=function(t,e,n,r,i,o){return l.findMultiRouteExactOut(t,e,n,r.map(T),i,o)},exports.findSingleRouteExactIn=function(t,e,n,r,i,o){return l.findSingleRouteExactIn(t,e,n,r.map(T),i,o)},exports.findSingleRouteExactOut=function(t,e,n,r,i,o){return l.findSingleRouteExactOut(t,e,n,r.map(T),i,o)};
//# sourceMappingURL=spray-sdk.cjs.production.min.js.map
