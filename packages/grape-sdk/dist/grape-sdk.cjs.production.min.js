"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e,n=(t=require("jsbi"))&&"object"==typeof t&&"default"in t?t.default:t,a=require("@champagneswap/core-sdk"),r=require("@ethersproject/constants"),i=require("@ethersproject/contracts"),s=require("@ethersproject/abi"),o=require("@champagneswap/cellar-sdk"),u=require("@ethersproject/bignumber"),d=require("@ethersproject/solidity"),p=require("@ethersproject/address"),l=n.BigInt("700000000000000000"),c=n.BigInt("800000000000000000"),y=n.BigInt("1000000000000000000"),h=n.BigInt("1000000000000000000"),m=n.subtract(h,c),f=n.multiply(n.BigInt(317097920),n.BigInt(31536e3)),A=n.multiply(n.BigInt(79274480),n.BigInt(31536e3)),T=n.multiply(n.BigInt(31709792e4),n.BigInt(31536e3)),I=n.BigInt("28800000000000000000000000000000000000000"),E=n.BigInt("1000000000000000000"),b=n.BigInt("10000"),v=n.BigInt("100000");function S(t,e,n,a,r,i,s){try{var o=t[i](s),u=o.value}catch(t){return void n(t)}o.done?e(u):Promise.resolve(u).then(a,r)}function B(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var i=t.apply(e,n);function s(t){S(i,a,r,s,o,"next",t)}function o(t){S(i,a,r,s,o,"throw",t)}s(void 0)}))}}function g(){return(g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}function x(t,e){return t(e={exports:{}},e.exports),e.exports}(e=exports.KashiAction||(exports.KashiAction={}))[e.ADD_ASSET=1]="ADD_ASSET",e[e.REPAY=2]="REPAY",e[e.REMOVE_ASSET=3]="REMOVE_ASSET",e[e.REMOVE_COLLATERAL=4]="REMOVE_COLLATERAL",e[e.BORROW=5]="BORROW",e[e.GET_REPAY_SHARE=6]="GET_REPAY_SHARE",e[e.GET_REPAY_PART=7]="GET_REPAY_PART",e[e.ACCRUE=8]="ACCRUE",e[e.ADD_COLLATERAL=10]="ADD_COLLATERAL",e[e.UPDATE_EXCHANGE_RATE=11]="UPDATE_EXCHANGE_RATE",e[e.BENTO_DEPOSIT=20]="BENTO_DEPOSIT",e[e.BENTO_WITHDRAW=21]="BENTO_WITHDRAW",e[e.BENTO_TRANSFER=22]="BENTO_TRANSFER",e[e.BENTO_TRANSFER_MULTIPLE=23]="BENTO_TRANSFER_MULTIPLE",e[e.BENTO_SETAPPROVAL=24]="BENTO_SETAPPROVAL",e[e.CALL=30]="CALL";var R=x((function(t){var e=function(t){var e=Object.prototype,n=e.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function o(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(t){o=function(t,e,n){return t[e]=n}}function u(t,e,n,a){var r=Object.create((e&&e.prototype instanceof l?e:l).prototype),i=new S(a||[]);return r._invoke=function(t,e,n){var a="suspendedStart";return function(r,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw i;return{value:void 0,done:!0}}for(n.method=r,n.arg=i;;){var s=n.delegate;if(s){var o=E(s,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var u=d(t,e,n);if("normal"===u.type){if(a=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a="completed",n.method="throw",n.arg=u.arg)}}}(t,n,i),r}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var p={};function l(){}function c(){}function y(){}var h={};o(h,r,(function(){return this}));var m=Object.getPrototypeOf,f=m&&m(m(B([])));f&&f!==e&&n.call(f,r)&&(h=f);var A=y.prototype=l.prototype=Object.create(h);function T(t){["next","throw","return"].forEach((function(e){o(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){var a;this._invoke=function(r,i){function s(){return new e((function(a,s){!function a(r,i,s,o){var u=d(t[r],t,i);if("throw"!==u.type){var p=u.arg,l=p.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){a("next",t,s,o)}),(function(t){a("throw",t,s,o)})):e.resolve(l).then((function(t){p.value=t,s(p)}),(function(t){return a("throw",t,s,o)}))}o(u.arg)}(r,i,a,s)}))}return a=a?a.then(s,s):s()}}function E(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,E(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=d(n,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,p;var r=a.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function v(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function B(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function e(){for(;++a<t.length;)if(n.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:g}}function g(){return{value:void 0,done:!0}}return c.prototype=y,o(A,"constructor",y),o(y,"constructor",c),c.displayName=o(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===c||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,o(t,s,"GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},T(I.prototype),o(I.prototype,i,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,a,r,i){void 0===i&&(i=Promise);var s=new I(u(e,n,a,r),i);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},T(A),o(A,s,"Generator"),o(A,r,(function(){return this})),o(A,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var a=e.pop();if(a in t)return n.value=a,n.done=!1,n}return n.done=!0,n}},t.values=B,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(v),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(n,a){return s.type="throw",s.arg=t,e.next=n,a&&(e.method="next",e.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var o=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(o&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),v(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var a=n.completion;if("throw"===a.type){var r=a.arg;v(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:B(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),_=[{inputs:[{internalType:"contract IBentoBoxV1",name:"bentoBox_",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_owner",type:"address"},{indexed:!0,internalType:"address",name:"_spender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"accruedAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"feeFraction",type:"uint256"},{indexed:!1,internalType:"uint64",name:"rate",type:"uint64"},{indexed:!1,internalType:"uint256",name:"utilization",type:"uint256"}],name:"LogAccrue",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"share",type:"uint256"},{indexed:!1,internalType:"uint256",name:"fraction",type:"uint256"}],name:"LogAddAsset",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"share",type:"uint256"}],name:"LogAddCollateral",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"feeAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"part",type:"uint256"}],name:"LogBorrow",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"rate",type:"uint256"}],name:"LogExchangeRate",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newFeeTo",type:"address"}],name:"LogFeeTo",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"share",type:"uint256"},{indexed:!1,internalType:"uint256",name:"fraction",type:"uint256"}],name:"LogRemoveAsset",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"share",type:"uint256"}],name:"LogRemoveCollateral",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"part",type:"uint256"}],name:"LogRepay",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"feeTo",type:"address"},{indexed:!1,internalType:"uint256",name:"feesEarnedFraction",type:"uint256"}],name:"LogWithdrawFees",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"accrue",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"accrueInfo",outputs:[{internalType:"uint64",name:"interestPerSecond",type:"uint64"},{internalType:"uint64",name:"lastAccrued",type:"uint64"},{internalType:"uint128",name:"feesEarnedFraction",type:"uint128"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"bool",name:"skim",type:"bool"},{internalType:"uint256",name:"share",type:"uint256"}],name:"addAsset",outputs:[{internalType:"uint256",name:"fraction",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"bool",name:"skim",type:"bool"},{internalType:"uint256",name:"share",type:"uint256"}],name:"addCollateral",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"asset",outputs:[{internalType:"contract IERC20",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"bentoBox",outputs:[{internalType:"contract IBentoBoxV1",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"borrow",outputs:[{internalType:"uint256",name:"part",type:"uint256"},{internalType:"uint256",name:"share",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"collateral",outputs:[{internalType:"contract IERC20",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint8[]",name:"actions",type:"uint8[]"},{internalType:"uint256[]",name:"values",type:"uint256[]"},{internalType:"bytes[]",name:"datas",type:"bytes[]"}],name:"cook",outputs:[{internalType:"uint256",name:"value1",type:"uint256"},{internalType:"uint256",name:"value2",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"exchangeRate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"feeTo",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"data",type:"bytes"}],name:"init",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address[]",name:"users",type:"address[]"},{internalType:"uint256[]",name:"maxBorrowParts",type:"uint256[]"},{internalType:"address",name:"to",type:"address"},{internalType:"contract ISwapper",name:"swapper",type:"address"},{internalType:"bool",name:"open",type:"bool"}],name:"liquidate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"masterContract",outputs:[{internalType:"contract KashiPairMediumRiskV1",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"oracle",outputs:[{internalType:"contract IOracle",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"oracleData",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pendingOwner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner_",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"fraction",type:"uint256"}],name:"removeAsset",outputs:[{internalType:"uint256",name:"share",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"share",type:"uint256"}],name:"removeCollateral",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"bool",name:"skim",type:"bool"},{internalType:"uint256",name:"part",type:"uint256"}],name:"repay",outputs:[{internalType:"uint256",name:"amount",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newFeeTo",type:"address"}],name:"setFeeTo",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract ISwapper",name:"swapper",type:"address"},{internalType:"bool",name:"enable",type:"bool"}],name:"setSwapper",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract ISwapper",name:"",type:"address"}],name:"swappers",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalAsset",outputs:[{internalType:"uint128",name:"elastic",type:"uint128"},{internalType:"uint128",name:"base",type:"uint128"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalBorrow",outputs:[{internalType:"uint128",name:"elastic",type:"uint128"},{internalType:"uint128",name:"base",type:"uint128"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalCollateralShare",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"},{internalType:"bool",name:"direct",type:"bool"},{internalType:"bool",name:"renounce",type:"bool"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"updateExchangeRate",outputs:[{internalType:"bool",name:"updated",type:"bool"},{internalType:"uint256",name:"rate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"userBorrowPart",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"userCollateralShare",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"withdrawFees",outputs:[],stateMutability:"nonpayable",type:"function"}],O=function(){function t(t,e,n,a){this.pair=t,this.account=e||r.AddressZero,this.library=n,this.chainId=a||1,this.actions=[],this.values=[],this.datas=[]}var e=t.prototype;return e.add=function(t,e,n){void 0===n&&(n=a.ZERO),this.actions.push(t),this.datas.push(e),this.values.push(n)},e.approve=function(t){t&&this.add(exports.KashiAction.BENTO_SETAPPROVAL,s.defaultAbiCoder.encode(["address","address","bool","uint8","bytes32","bytes32"],[t.account,t.masterContract,!0,t.v,t.r,t.s]))},e.updateExchangeRate=function(t,e,n){return void 0===t&&(t=!1),void 0===e&&(e=a.ZERO),void 0===n&&(n=a.ZERO),this.add(exports.KashiAction.UPDATE_EXCHANGE_RATE,s.defaultAbiCoder.encode(["bool","uint256","uint256"],[t,e,n])),this},e.bentoDepositCollateral=function(t){var e=this.pair.collateral.address===a.WNATIVE_ADDRESS[this.chainId];return this.add(exports.KashiAction.BENTO_DEPOSIT,s.defaultAbiCoder.encode(["address","address","int256","int256"],[e?r.AddressZero:this.pair.collateral.address,this.account,t,0]),e?t:a.ZERO),this},e.bentoWithdrawCollateral=function(t,e){var n=this.pair.collateral.address===a.WNATIVE_ADDRESS[this.chainId];return this.add(exports.KashiAction.BENTO_WITHDRAW,s.defaultAbiCoder.encode(["address","address","int256","int256"],[n?r.AddressZero:this.pair.collateral.address,this.account,t,e]),n?t:a.ZERO),this},e.bentoTransferCollateral=function(t,e){return this.add(exports.KashiAction.BENTO_TRANSFER,s.defaultAbiCoder.encode(["address","address","int256"],[this.pair.collateral.address,e,t])),this},e.repayShare=function(t){return this.add(exports.KashiAction.GET_REPAY_SHARE,s.defaultAbiCoder.encode(["int256"],[t])),this},e.addCollateral=function(t,e){var i;if(e)i=n.lessThan(t,a.ZERO)?t:o.toShare(this.pair.collateral,t);else{var u=this.pair.collateral.address===a.WNATIVE_ADDRESS[this.chainId];this.add(exports.KashiAction.BENTO_DEPOSIT,s.defaultAbiCoder.encode(["address","address","int256","int256"],[u?r.AddressZero:this.pair.collateral.address,this.account,t,0]),u?t:a.ZERO),i=n.BigInt(-2)}return this.add(exports.KashiAction.ADD_COLLATERAL,s.defaultAbiCoder.encode(["int256","address","bool"],[i,this.account,!1])),this},e.addAsset=function(t,e){var i;if(e)i=o.toShare(this.pair.asset,t);else{var u=this.pair.asset.address===a.WNATIVE_ADDRESS[this.chainId];this.add(exports.KashiAction.BENTO_DEPOSIT,s.defaultAbiCoder.encode(["address","address","int256","int256"],[u?r.AddressZero:this.pair.asset.address,this.account,t,0]),u?t:a.ZERO),i=n.BigInt(-2)}return this.add(exports.KashiAction.ADD_ASSET,s.defaultAbiCoder.encode(["int256","address","bool"],[i,this.account,!1])),this},e.removeAsset=function(t,e){return this.add(exports.KashiAction.REMOVE_ASSET,s.defaultAbiCoder.encode(["int256","address"],[t,this.account])),e||this.add(exports.KashiAction.BENTO_WITHDRAW,s.defaultAbiCoder.encode(["address","address","int256","int256"],[this.pair.asset.address===a.WNATIVE_ADDRESS[this.chainId]?r.AddressZero:this.pair.asset.address,this.account,0,-1])),this},e.removeCollateral=function(t,e){return this.add(exports.KashiAction.REMOVE_COLLATERAL,s.defaultAbiCoder.encode(["int256","address"],[t,this.account])),e||this.add(exports.KashiAction.BENTO_WITHDRAW,s.defaultAbiCoder.encode(["address","address","int256","int256"],[this.pair.collateral.address===a.WNATIVE_ADDRESS[this.chainId]?r.AddressZero:this.pair.collateral.address,this.account,0,t])),this},e.removeCollateralFraction=function(t,e){return this.add(exports.KashiAction.REMOVE_COLLATERAL,s.defaultAbiCoder.encode(["int256","address"],[t,this.account])),e||this.add(exports.KashiAction.BENTO_WITHDRAW,s.defaultAbiCoder.encode(["address","address","int256","int256"],[this.pair.collateral.address===a.WNATIVE_ADDRESS[this.chainId]?r.AddressZero:this.pair.collateral.address,this.account,0,-1])),this},e.borrow=function(t,e,n){return void 0===n&&(n=""),this.add(exports.KashiAction.BORROW,s.defaultAbiCoder.encode(["int256","address"],[t,n&&e?n:this.account])),e||this.add(exports.KashiAction.BENTO_WITHDRAW,s.defaultAbiCoder.encode(["address","address","int256","int256"],[this.pair.asset.address===a.WNATIVE_ADDRESS[this.chainId]?r.AddressZero:this.pair.asset.address,n||this.account,t,0])),this},e.repay=function(t,e){if(!e){var n=this.pair.asset.address===a.WNATIVE_ADDRESS[this.chainId];this.add(exports.KashiAction.BENTO_DEPOSIT,s.defaultAbiCoder.encode(["address","address","int256","int256"],[n?r.AddressZero:this.pair.asset.address,this.account,t,0]),n?t:a.ZERO)}return this.add(exports.KashiAction.GET_REPAY_PART,s.defaultAbiCoder.encode(["int256"],[e?t:-1])),this.add(exports.KashiAction.REPAY,s.defaultAbiCoder.encode(["int256","address","bool"],[-1,this.account,!1])),this},e.repayPart=function(t,e){if(!e){var i=this.pair.asset.address===a.WNATIVE_ADDRESS[this.chainId];this.add(exports.KashiAction.GET_REPAY_SHARE,s.defaultAbiCoder.encode(["int256"],[t])),this.add(exports.KashiAction.BENTO_DEPOSIT,s.defaultAbiCoder.encode(["address","address","int256","int256"],[i?r.AddressZero:this.pair.asset.address,this.account,0,-1]),i?n.divide(n.multiply(o.toShare(this.pair.asset,a.toElastic(this.pair.totalBorrow,t,!0)),n.BigInt(1001)),n.BigInt(1e3)):a.ZERO)}return this.add(exports.KashiAction.REPAY,s.defaultAbiCoder.encode(["int256","address","bool"],[t,this.account,!1])),this},e.action=function(t,e,n,a,r,i){this.add(exports.KashiAction.CALL,s.defaultAbiCoder.encode(["address","bytes","bool","bool","uint8"],[t,n,a,r,i]),e)},e.cook=function(){var t=B(R.mark((function t(){var e;return R.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.library){t.next=2;break}return t.abrupt("return",{success:!1});case 2:return e=new i.Contract(this.pair.address,_,a.getProviderOrSigner(this.library,this.account)),t.prev=3,t.next=6,e.cook(this.actions,this.values,this.datas,{value:this.values.reduce((function(t,e){return n.add(t,e)}),a.ZERO)});case 6:return t.t0=t.sent,t.abrupt("return",{success:!0,tx:t.t0});case 10:return t.prev=10,t.t1=t.catch(3),console.error("KashiCooker Error: ",t.t1),t.abrupt("return",{success:!1,error:t.t1});case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(){return t.apply(this,arguments)}}(),t}(),w=function(t){var e=t.collateral;return p.getCreate2Address(a.BENTOBOX_ADDRESS[e.chainId],d.keccak256(["bytes"],[s.defaultAbiCoder.encode(["address","address","address","bytes"],[e.address,t.asset.address,t.oracle,t.oracleData])]),d.keccak256(["bytes"],["0x3d602d80600a3d3981f3363d3d373d3d3d363d73"+a.KASHI_ADDRESS[e.chainId].substring(2)+"5af43d82803e903d91602b57fd5bf3"]))};function J(t,e,n){return void 0===n&&(n=!1),a.JSBI.add(a.JSBI.divide(a.JSBI.multiply(a.JSBI.multiply(e,t.accrueInfo.interestPerSecond),t.elapsedSeconds),a.JSBI.BigInt(1e18)),n?e:a.ZERO)}function C(t){var e=a.JSBI.divide(a.JSBI.multiply(a.JSBI.multiply(t.totalBorrow.elastic,t.accrueInfo.interestPerSecond),a.JSBI.add(t.elapsedSeconds,a.JSBI.BigInt(3600))),a.JSBI.BigInt(1e18)),n=a.JSBI.divide(a.JSBI.multiply(e,b),v),r=a.JSBI.divide(a.JSBI.multiply(n,t.totalAsset.base),t.currentAllAssets);return{elastic:t.totalAsset.elastic,base:a.JSBI.add(t.totalAsset.base,r)}}function L(t,e){if(a.JSBI.equal(t.totalBorrow.base,a.ZERO))return f;if(a.JSBI.lessThanOrEqual(t.elapsedSeconds,a.ZERO))return e;var n=e;if(a.JSBI.lessThan(t.utilization,l)){var r=a.JSBI.greaterThan(l,a.ZERO)?a.JSBI.divide(a.JSBI.multiply(a.JSBI.subtract(l,t.utilization),E),l):a.ZERO,i=a.JSBI.add(I,a.JSBI.multiply(a.JSBI.multiply(r,r),t.elapsedSeconds));n=a.JSBI.divide(a.JSBI.multiply(n,I),i),a.JSBI.lessThan(n,A)&&(n=A)}else if(a.JSBI.greaterThan(t.utilization,c)){var s=a.JSBI.multiply(a.JSBI.subtract(t.utilization,c),a.JSBI.divide(E,m)),o=a.JSBI.add(I,a.JSBI.multiply(a.JSBI.multiply(s,s),t.elapsedSeconds));n=a.JSBI.divide(a.JSBI.multiply(n,o),I),a.JSBI.greaterThan(n,T)&&(n=T)}return n}function N(t){return a.JSBI.subtract(t,a.JSBI.divide(a.JSBI.multiply(t,b),v))}var P=function(){function t(t,e,n,a,r,i,s,o,u,d,p,l){this.accrueInfo=t,this.collateral=e,this.asset=n,this.totalCollateralShare=a,this.totalAsset=r,this.totalBorrow=i,this.exchangeRate=s,this.oracleExchangeRate=o,this.spotExchangeRate=u,this.userCollateralShare=d,this.userAssetFraction=p,this.userBorrowPart=l}var e,n;return t.getAddress=function(t,e,n,a){return w({collateral:t,asset:e,oracle:n,oracleData:a})},e=t,(n=[{key:"elapsedSeconds",get:function(){var t=a.JSBI.divide(a.JSBI.BigInt(Date.now()),a.JSBI.BigInt(1e3));return a.JSBI.subtract(t,this.accrueInfo.lastAccrued)}},{key:"interestPerYear",get:function(){return a.JSBI.multiply(this.accrueInfo.interestPerSecond,a.JSBI.BigInt(31536e3))}},{key:"currentInterestPerYear",get:function(){return L(this,this.interestPerYear)}},{key:"totalCollateralAmount",get:function(){return o.toAmount(this.collateral,this.totalCollateralShare)}},{key:"totalAssetAmount",get:function(){return o.toAmount(this.asset,this.totalAsset.elastic)}},{key:"currentBorrowAmount",get:function(){return J(this,this.totalBorrow.elastic,!0)}},{key:"currentAllAssets",get:function(){return a.JSBI.add(this.totalAssetAmount,this.currentBorrowAmount)}},{key:"currentAllAssetShares",get:function(){return o.toShare(this.asset,this.currentAllAssets)}},{key:"currentTotalAsset",get:function(){return C(this)}},{key:"maxAssetAvailable",get:function(){return a.minimum(a.JSBI.divide(a.JSBI.multiply(this.totalAsset.elastic,this.currentAllAssets),this.currentAllAssetShares),o.toAmount(this.asset,a.toElastic(this.currentTotalAsset,a.JSBI.subtract(this.totalAsset.base,a.JSBI.BigInt(1e3)),!1)))}},{key:"maxAssetAvailableFraction",get:function(){return a.JSBI.divide(a.JSBI.multiply(this.maxAssetAvailable,this.currentTotalAsset.base),this.currentAllAssets)}},{key:"marketHealth",get:function(){return a.JSBI.divide(a.JSBI.multiply(a.JSBI.divide(a.JSBI.multiply(this.totalCollateralAmount,a.JSBI.BigInt(1e18)),a.maximum(this.exchangeRate,this.spotExchangeRate,this.oracleExchangeRate)),a.JSBI.BigInt(1e18)),this.currentBorrowAmount)}},{key:"utilization",get:function(){return a.JSBI.divide(a.JSBI.multiply(a.JSBI.BigInt(1e18),this.currentBorrowAmount),this.currentAllAssets)}},{key:"supplyAPR",get:function(){return N(a.JSBI.divide(a.JSBI.multiply(this.interestPerYear,this.utilization),a.JSBI.BigInt(1e18)))}},{key:"currentSupplyAPR",get:function(){return N(a.JSBI.divide(a.JSBI.multiply(this.currentInterestPerYear,this.utilization),a.JSBI.BigInt(1e18)))}},{key:"userCollateralAmount",get:function(){return o.toAmount(this.collateral,this.userCollateralShare)}},{key:"currentUserAssetAmount",get:function(){return a.JSBI.divide(a.JSBI.multiply(this.userAssetFraction,this.currentAllAssets),this.totalAsset.base)}},{key:"currentUserBorrowAmount",get:function(){return a.JSBI.equal(this.userBorrowPart,a.ZERO)?a.ZERO:a.JSBI.divide(a.JSBI.multiply(this.userBorrowPart,this.currentBorrowAmount),this.totalBorrow.base)}},{key:"currentUserLentAmount",get:function(){return a.JSBI.divide(a.JSBI.multiply(this.userAssetFraction,this.currentBorrowAmount),this.totalAsset.base)}},{key:"feesEarned",get:function(){return a.JSBI.divide(a.JSBI.multiply(this.accrueInfo.feesEarnedFraction,this.currentAllAssets),this.totalAsset.base)}},{key:"maxBorrowable",get:function(){var t={oracle:a.JSBI.divide(a.JSBI.multiply(this.userCollateralAmount,a.JSBI.multiply(a.JSBI.BigInt(1e16),a.JSBI.BigInt(75))),this.oracleExchangeRate),spot:a.JSBI.divide(a.JSBI.multiply(this.userCollateralAmount,a.JSBI.multiply(a.JSBI.BigInt(1e16),a.JSBI.BigInt(75))),this.spotExchangeRate),stored:a.JSBI.divide(a.JSBI.multiply(this.userCollateralAmount,a.JSBI.multiply(a.JSBI.BigInt(1e16),a.JSBI.BigInt(75))),this.exchangeRate)},e=a.minimum.apply(void 0,Object.values(t)),n=a.JSBI.subtract(a.JSBI.divide(a.JSBI.multiply(e,a.JSBI.BigInt(95)),a.JSBI.BigInt(100)),this.currentUserBorrowAmount);return g({},t,{minimum:e,safe:n,possible:a.minimum(n,this.maxAssetAvailable)})}},{key:"health",get:function(){return a.JSBI.divide(a.JSBI.multiply(this.currentUserBorrowAmount,a.JSBI.BigInt(1e18)),this.maxBorrowable.minimum)}}])&&function(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();exports.ACTION_ACCRUE=8,exports.ACTION_ADD_ASSET=1,exports.ACTION_ADD_COLLATERAL=10,exports.ACTION_BENTO_DEPOSIT=20,exports.ACTION_BENTO_SETAPPROVAL=24,exports.ACTION_BENTO_TRANSFER=22,exports.ACTION_BENTO_TRANSFER_MULTIPLE=23,exports.ACTION_BENTO_WITHDRAW=21,exports.ACTION_BORROW=5,exports.ACTION_CALL=30,exports.ACTION_GET_REPAY_PART=7,exports.ACTION_GET_REPAY_SHARE=6,exports.ACTION_REMOVE_ASSET=3,exports.ACTION_REMOVE_COLLATERAL=4,exports.ACTION_REPAY=2,exports.ACTION_UPDATE_EXCHANGE_RATE=11,exports.FACTOR_PRECISION=E,exports.FULL_UTILIZATION=h,exports.FULL_UTILIZATION_MINUS_MAX=m,exports.INTEREST_ELASTICITY=I,exports.KashiCooker=O,exports.KashiMediumRiskLendingPair=P,exports.MAXIMUM_INTEREST_PER_YEAR=T,exports.MAXIMUM_TARGET_UTILIZATION=c,exports.MINIMUM_INTEREST_PER_YEAR=A,exports.MINIMUM_TARGET_UTILIZATION=l,exports.PROTOCOL_FEE=b,exports.PROTOCOL_FEE_DIVISOR=v,exports.STARTING_INTEREST_PER_YEAR=f,exports.UTILIZATION_PRECISION=y,exports.accrue=J,exports.accrueTotalAssetWithFee=C,exports.addBorrowFee=function(t){return t.mul(u.BigNumber.from(10005)).div(u.BigNumber.from(1e4))},exports.computePairAddress=w,exports.interestAccrue=L,exports.takeFee=N;
//# sourceMappingURL=grape-sdk.cjs.production.min.js.map
